<script>
  // simple local user store
  function getStore() {
    try {
      return JSON.parse(localStorage.getItem('teeradar_users')) || { users: {} };
    } catch(e) {
      return { users: {} };
    }
  }
  function saveStore(store) {
    localStorage.setItem('teeradar_users', JSON.stringify(store));
  }

  // ensure your admin exists
  const ADMIN_EMAIL = "declan7pin@gmail.com";
  const ADMIN_PASSWORD = "Kelmscott1";

  (function ensureAdmin(){
    const store = getStore();
    if (!store.users[ADMIN_EMAIL]) {
      store.users[ADMIN_EMAIL] = { password: ADMIN_PASSWORD, role: "admin", subscription: "active" };
      saveStore(store);
    }
  })();

  function login() {
    const email = document.getElementById('email').value.trim().toLowerCase();
    const pw = document.getElementById('pw').value;
    if (!email || !pw) {
      alert("Enter email and password");
      return;
    }

    const store = getStore();
    const existing = store.users[email];

    if (!existing) {
      // if you DON'T want anyone else creating accounts, stop here:
      alert("This account does not exist. Ask admin to create it.");
      return;
    }

    if (existing.password !== pw) {
      alert("Incorrect password");
      return;
    }

    // mark session
    localStorage.setItem('teeradar_member', '1');
    localStorage.setItem('teeradar_email', email);

    // if admin, mark role
    if (email === ADMIN_EMAIL) {
      localStorage.setItem('teeradar_role', 'admin');
    } else {
      localStorage.setItem('teeradar_role', 'member');
    }

    // send to booking or admin
    if (email === ADMIN_EMAIL) {
      window.location.href = "/admin.html";
    } else {
      window.location.href = "/book.html";
    }
  }
</script>

